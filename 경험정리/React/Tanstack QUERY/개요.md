웹 어플리케이션에서 서버상태
- 쉽게 가져오기
- 캐싱
- 동기화 및 업데이트
기능을 지원한다.


왜 이런 상태 정의에 대한 분리된 접근이 필요할까?

### 서버 상태
- 서버 상태는 벡엔드에 뿌리를 두고 있는 데이터
- DB, 파일시스템, 캐시 등에 저장되어 관리됨
- 영속적인 데이터
- 모든 클라이언트에게 동일한 데이터를 제공
- 클라이언트에서 요청이 있을 시에만 API 를 통해서 클라이언트에 데이터 전달됨
- 비동기 상태를 거침

### 클라이언트 상태
- 프론트에서 관리되는 데이터
- 사용자의 PC의 브라우저, 핸드폰의 앱 내에서 저장되어 관리
- 한 사용자 환경에서 유요한 데이터
- 주로 UI 상태, 사용자 입력값, 임시 데이터 등등을 저장하고 관리함
- 사용자 사용경험 개선을 위해, 클라이언트 단에서 빠르게 데이터를 제공하기 위함
- 클라이언트 데이터를 업데이트 해야할 상황에서는 서버에 요청하여 새로운 데이터를 제공받음


사용법은?
tanstack 의 react-query 는 크게 2가지 hooks 기반으로 되어 있고, 2가지 hooks 을 통해서 기능을 제공해주고 있다.

- Queries
- Mutations
- Query Invalidation

으로 3가지가 제공된다.

#### Queries
데이터를 fetching 해올 때 사용된다. 크게는

- useQuery
- useQueries

가 제공된다. HTTP Methods 중에서도 GET 에 해당된다. 이 때 cache 에 대한 설정을 해줄 수 있는데,

- staleTime
	- 몇몇 상태값이 있는데, fresh, stale 이다
	- staleTime 만큼 fresh 상태를 유지하다가 시간이 지나면 stale 로 자동 변경된다.
	- stale 상태가 되고 특정 조건이 만족되면 refetching 을 수행한다.
- cacheTime
	- 설정한 시간만큼 데이터를 메모리에 저장 == queries 배열과 queriesMap 객체에 Query 객체를 저장해두는 것
	- cache 가 존재하더라도 해당 Query 객체가 stale 상태라면 refetching 을 수행한다.

등등의 옵션으로 설정을 해줘야한다. stale 과 cache 라는 두가지 개념을 다루는 이유는 refetching 할 시 사용자의 UX를 높이기 위해서이다.
https://www.timegambit.com/blog/digging/react-query/03


#### Mutations
데이터를 업데이트 하거나 삭제하는데 사용된다.

- useMudtaion

가 제공된다. HTTP Methods 중에서도 POST, PUT, DELETE 에 해당된다.


#### Query Invalidation
react-query 는 캐싱을 사용한다. 관리해야할 캐싱이 많아지거나 react-query 내부 시스템에만 cache 을 의존했을 시 개발자가 의도하는 상황을 구현하기 힘든 경우가 발생할 것이다. 이때 캐싱을 다시 초기화 해주는 행위를 통해 새롭게 다시 시작해주는 것이 좋은 경우가 있다. 그 때 query 의 invalidateQueries() 를 사용해주면 된다.

- queryClient.invalidateQueries

캐시 무효화 할 시 key, query 조건 등등을 통해 캐싱을 특정지을 수 있다.

__캐시 무효화가 필요할 때__
- 데이터 변경 후 최신 상태 반영
```typescript
mutation.mutate(newTodo, {
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['todos'] });
  },
});
```
- 사용자가 의도적으로 데이터 새로고침 요청
```typescript
const handleRefresh = () => {
  queryClient.invalidateQueries({ queryKey: ['todos'] });
};
```
- 의존 관계가 있는 데이터가 변경된 경우
```typescript
mutation.mutate(updatedUser, {
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['user'] });
    queryClient.invalidateQueries({ queryKey: ['dashboard'] });
  },
});
```
- 외부 이벤트로 인한 데이터 변경
```typescript
socket.on('newMessage', () => {
  queryClient.invalidateQueries({ queryKey: ['messages'] });
});
```




5시 까지 Query 오픈 소스 탐험
6시 까지 remote config 기능 마무리
7시 까지 프론트 지식 다시 한번더 살피기